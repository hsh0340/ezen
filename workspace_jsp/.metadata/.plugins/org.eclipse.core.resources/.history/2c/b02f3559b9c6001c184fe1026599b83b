<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="java.sql.*, java.text.SimpleDateFormat" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>selectTest01</title>
<style>
	#container {
		width: 800px;
		margin: 20px auto;
	}
	
	h2 {
		text-align: center;
	}
	
	table {
		border: 1px solid black;
		border-collapse: collapse;
	}
	
	tr {
		height: 35px;
	}
	
	th, td {
		border: 1px solid black;
	}
	
	th {
		background-color: #ccc;
	}
</style>
</head>
<%--


 --%>
<body>

	<div id="container">
		<h2>전체 회원 정보 확인</h2>
		
		<%
		request.setCharacterEncoding("utf-8");
		SimpleDateFormat sdf = new SimpleDateFormat("yyyy년 MM월 dd일 hh:mm:ss");
		
		// DB의 접속 정보
		String url = "jdbc:mysql://localhost:3306/db01?SSL=false;";
		String dbId = "ezen01"; // db에서 얻어온 id
		String dbPwd = "1234"; // db에서 얻어온 pwd
				
		// 연결, 질의, 결과테이블 객체
		Connection conn = null; // 연결
		PreparedStatement pstmt = null; // 질의
		ResultSet rs = null; // 결과테이블 객체
		
		// sql문 - SELECT 일 때
		String sql = "SELECT * FROM member";
		
		try {
			Class.forName("com.mysql.jdbc.Driver"); // 1단계 - 드라이버 연결
			conn = DriverManager.getConnection(url, dbId, dbPwd); // 2단계 - DB 접속
			
			pstmt = conn.prepareStatement(sql); // 3단계 - PreparedStatement 객체 생성 
			rs = pstmt.executeQuery(); // 4단계 - sql 실행
			
			out.print("<table><tr><th>아이디</th><th>비밀번호</th><th>이름</th><th>나이</th><th>가입일자</th></tr>");
			// 
			while (rs.next()) { // rs는 첫 행 바로 위 가리키고있음. next() : 다음행이 있는지?
				String id = rs.getString("id");
				String pwd = rs.getString("pwd");
				String name = rs.getString("name");
				int age = rs.getInt("age");
				Timestamp regDate = rs.getTimestamp("regDate");
				
				out.print("<tr>");
				out.print("<td width='15%'>" + id + "</td>");
				out.print("<td width='15%'>" + pwd + "</td>");
				out.print("<td width='10%'>" + name + "</td>");
				out.print("<td width='10%'>" + age + "</td>");
				out.print("<td width='50%'>" + sdf.format(regDate) + "</td>");
				out.print("</tr>");	
			}	
			out.print("</table>");
		} catch(Exception e) {
			e.printStackTrace();
			out.print("데이터 조회시에 예외가 발생하였습니다.");
		} finally { // 연 순서 역순으로 닫기
			if (rs != null) try {rs.close();} catch(Exception e) {e.printStackTrace();} // 닫으면서 예외처리
			
			if (pstmt != null) try {pstmt.close();} catch(Exception e) {e.printStackTrace();} // 닫으면서 예외처리
			
			if (conn != null)  try {conn.close();} catch(Exception e) {e.printStackTrace();} // 닫으면서 예외처리
		}
		%>
	</div>

</body>
</html>